<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>注解和反射 | secqin</title><meta name="keywords" content="javase"><meta name="author" content="secqin"><meta name="copyright" content="secqin"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. 注解注解不仅可以给人看也可以给程序看 annotation 注解 comnt 注释 1.1 注解入门 Annotation 是从JDK5.0开始引入的新技术 .  Annotation的作用   ​            不是程序本身 , 可以对程序作出解释.(这一点和注释(comment)没什么区别) ​            可以被其他程序(比如:编译器等)读取.  Annotation">
<meta property="og:type" content="article">
<meta property="og:title" content="注解和反射">
<meta property="og:url" content="https://liqin123456.github.io/2022/01/22/%E6%B3%A8%E8%A7%A3%E5%92%8C%E5%8F%8D%E5%B0%84/index.html">
<meta property="og:site_name" content="secqin">
<meta property="og:description" content="1. 注解注解不仅可以给人看也可以给程序看 annotation 注解 comnt 注释 1.1 注解入门 Annotation 是从JDK5.0开始引入的新技术 .  Annotation的作用   ​            不是程序本身 , 可以对程序作出解释.(这一点和注释(comment)没什么区别) ​            可以被其他程序(比如:编译器等)读取.  Annotation">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/liqincoding/img/master/95948932_p0_master1200.jpg">
<meta property="article:published_time" content="2022-01-22T11:28:37.000Z">
<meta property="article:modified_time" content="2022-03-02T08:30:11.208Z">
<meta property="article:author" content="secqin">
<meta property="article:tag" content="javase">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/liqincoding/img/master/95948932_p0_master1200.jpg"><link rel="shortcut icon" href="http://q.qlogo.cn/headimg_dl?dst_uin=515262617&spec=640&img_type=jpg"><link rel="canonical" href="https://liqin123456.github.io/2022/01/22/%E6%B3%A8%E8%A7%A3%E5%92%8C%E5%8F%8D%E5%B0%84/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '注解和反射',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-02 16:30:11'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/liqin123456/liqin123456.github.io/css/li.css"><meta name="generator" content="Hexo 6.0.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="http://q.qlogo.cn/headimg_dl?dst_uin=515262617&amp;spec=640&amp;img_type=jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fas fa-heart"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">secqin</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fas fa-heart"></i><span> 说说</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">注解和反射</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-01-22T11:28:37.000Z" title="发表于 2022-01-22 19:28:37">2022-01-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-03-02T08:30:11.208Z" title="更新于 2022-03-02 16:30:11">2022-03-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/javase/">javase</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="注解和反射"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="1-注解"><a href="#1-注解" class="headerlink" title="1. 注解"></a>1. 注解</h1><p>注解不仅可以给人看也可以给程序看</p>
<p>annotation 注解</p>
<p>comnt 注释</p>
<h2 id="1-1-注解入门"><a href="#1-1-注解入门" class="headerlink" title="1.1 注解入门"></a>1.1 注解入门</h2><ul>
<li><p>Annotation 是从JDK5.0开始引入的新技术 .</p>
</li>
<li><p>Annotation的作用</p>
</li>
</ul>
<p>​            不是程序本身 , 可以对程序作出解释.(这一点和注释(comment)没什么区别)</p>
<p>​            可以被其他程序(比如:编译器等)读取.</p>
<ul>
<li>Annotation的格式</li>
</ul>
<p>​            注解是以”@注释名”在代码中存在的</p>
<p>​            还可以添加一些参数值 , 例如:@SuppressWarnings(value=”unchecked”)</p>
<ul>
<li>Annotation在哪里使用?</li>
</ul>
<p>​            可以附加在package , class , method , fifield 等上面 , 相当于给他们添加了额外的辅助信息</p>
<p>​            我们可以通过反射机制实现对这些元数据的访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span> <span class="comment">//    重写的注解</span></span><br></pre></td></tr></table></figure>

<h2 id="1-2-内置注解"><a href="#1-2-内置注解" class="headerlink" title="1.2 内置注解"></a>1.2 内置注解</h2><ul>
<li>@Override</li>
</ul>
<p>​        定义在 java.lang.Override 中 , 此注释只适用于修辞方法 , 表示一个方法声明打算重写超类中</p>
<p>​        的另一个方法声明.</p>
<ul>
<li>@Deprecated</li>
</ul>
<p>​        定义在java.lang.Deprecated中 , 此注释可以用于修辞方法 , 属性 , 类 ,</p>
<p>​        作用是不鼓励程序员使用这样的元素 , 通常是因为它很危险或者存在更好的选择 .</p>
<ul>
<li>@SuppressWarnings</li>
</ul>
<p>​        定义在java.lang.SuppressWarnings中,用来抑制编译时的警告信息.</p>
<p>​        与前两个注释有所不同,你需要添加一个参数才能正确使用,这些参数都是已经定义好了的,我们</p>
<p>​        选择性的使用就好了 .</p>
<p>​        可以传参数的注解</p>
<p>@SuppressWarnings(“all”)    // 镇压全部警告</p>
<p>@SuppressWarnings(“unchecked”)    // </p>
<p>@SuppressWarnings(value={“unchecked”,”deprecation”})</p>
<p>等等 </p>
<h2 id="1-3-元注解"><a href="#1-3-元注解" class="headerlink" title="1.3 元注解"></a>1.3 元注解</h2><ul>
<li>元注解的作用就是负责注解其他注解 , Java定义了4个标准的meta-annotation类型,他们被用来提供</li>
</ul>
<p>对其他annotation类型作说明 .</p>
<ul>
<li>这些类型和它们所支持的类在java.lang.annotation包中可以找到 .( @Target , @Retention ,</li>
</ul>
<p>@Documented , @Inherited )</p>
<p>@Target : 用于描述注解的使用范围(即:被描述的注解可以用在什么地方)</p>
<p>@Retention : 表示需要在什么级别保存该注释信息 , 用于描述注解的生命周期</p>
<p>(SOURCE &lt; CLASS &lt; RUNTIME)</p>
<p>@Document：说明该注解将被包含在javadoc中</p>
<p>@Inherited：说明子类可以继承父类中的该注解</p>
<blockquote>
<p>定义一个注解</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个注解 </span></span><br><span class="line"><span class="comment">//表示我们的注解可以使用在哪些地方</span></span><br><span class="line"><span class="meta">@Target(value = &#123;ElementType.METHOD,ElementType.TYPE&#125;)</span> </span><br><span class="line"><span class="comment">//表示我们的注解在什么地方还有效</span></span><br><span class="line">runtime&gt;<span class="class"><span class="keyword">class</span>&gt;<span class="title">sources</span></span></span><br><span class="line"><span class="class">@<span class="title">Retention</span>(<span class="title">value</span> </span>= RetentionPolicy.RUNTIME) </span><br><span class="line"><span class="comment">//子类可以继承父类的注解</span></span><br><span class="line"><span class="meta">@Inherited</span> </span><br><span class="line"><span class="comment">//表示是否将我们的注解生成在javadoc中</span></span><br><span class="line"><span class="meta">@Documented</span> </span><br><span class="line"><span class="meta">@interface</span> MyAnnotation&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-自定义注解"><a href="#1-4-自定义注解" class="headerlink" title="1.4 自定义注解"></a>1.4 自定义注解</h3><p>使用 @interface自定义注解时 , 自动继承了java.lang.annotation.Annotation接口</p>
<p>分析 :</p>
<p>@ interface用来声明一个注解 , 格式 : public @ interface 注解名 { 定义内容 }</p>
<p>其中的每一个方法实际上是声明了一个配置参数.</p>
<p>方法的名称就是参数的名称.</p>
<p>返回值类型就是参数的类型 ( 返回值只能是基本类型,Class , String , enum ).</p>
<p>可以通过default来声明参数的默认值</p>
<p>如果只有一个参数成员 , 一般参数名为value</p>
<p>注解元素必须要有值 , 我们定义注解元素时 , 经常使用空字符串,0作为默认值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.annotation; </span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType; </span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention; </span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy; </span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target; <span class="comment">//测试自定义注解 </span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test3</span> </span>&#123; <span class="comment">//显示定义值 / 不显示值就是默认值 </span></span><br><span class="line">    <span class="meta">@MyAnnotation2(age = 18,name = &quot;黎钦&quot;,id = 001,schools = &#123;&quot;武汉科技大学&quot;&#125;)</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123; &#125;<span class="comment">//只有一个参数, 默认名字一般是value.使用可省略不写 </span></span><br><span class="line">    <span class="meta">@MyAnnotation3(&quot;aaa&quot;)</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123; &#125; &#125;</span><br><span class="line"><span class="meta">@Target(value = &#123;ElementType.METHOD&#125;)</span> </span><br><span class="line"><span class="meta">@Retention(value = RetentionPolicy.RUNTIME)</span> </span><br><span class="line"><span class="meta">@interface</span> MyAnnotation2&#123; <span class="comment">//参数类型 , 参数名 </span></span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>; </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">age</span><span class="params">()</span> <span class="keyword">default</span> 0</span>; </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">id</span><span class="params">()</span> <span class="keyword">default</span> -1</span>; <span class="comment">//String indexOf(&quot;abc&quot;) -1 , 不存在,找不到 </span></span><br><span class="line">    String[] schools() <span class="keyword">default</span> &#123;<span class="string">&quot;黎钦&quot;</span>,<span class="string">&quot;帅哥&quot;</span>&#125;; &#125;</span><br><span class="line"><span class="meta">@Target(value = &#123;ElementType.METHOD&#125;)</span> </span><br><span class="line"><span class="meta">@Retention(value = RetentionPolicy.RUNTIME)</span> </span><br><span class="line"><span class="meta">@interface</span> MyAnnotation3&#123;</span><br><span class="line"><span class="comment">// 参数类型 参数名称 </span></span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span></span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-反射机制"><a href="#2-反射机制" class="headerlink" title="2. 反射机制"></a>2. 反射机制</h1><p>反射机制让Java成了动态语言</p>
<h2 id="2-1-静态vs动态语言"><a href="#2-1-静态vs动态语言" class="headerlink" title="2.1 静态vs动态语言"></a>2.1 静态vs动态语言</h2><p><strong>动态语言</strong></p>
<ul>
<li>是一类在运行时可以改变其结构的语言：例如新的函数、对象、甚至代码可以被引进，已有的</li>
</ul>
<p>函数可以被删除或是其他结构上的变化。通俗点说就是在运行时代码可以根据某些条件改变自</p>
<p>身结构。</p>
<ul>
<li>主要动态语言：Object-C、C#、JavaScript、PHP、Python等。</li>
</ul>
<p><strong>静态语言</strong></p>
<ul>
<li><p>与动态语言相对应的，运行时结构不可变的语言就是静态语言。如Java、C、C++。</p>
</li>
<li><p>Java不是动态语言，但Java可以称之为“准动态语言”。即Java有一定的动态性，我们可以利用反射机制获得类似动态语言的特性。Java的动态性让编程的时候更加灵活！</p>
</li>
</ul>
<h2 id="2-2-Java-Reflection"><a href="#2-2-Java-Reflection" class="headerlink" title="2.2 Java Reflection"></a>2.2 Java Reflection</h2><p><strong>Reflflection（反射）</strong>是Java被视为动态语言的关键，反射机制允许程序在执行期借助于Reflflection API取</p>
<p>得任何类的内部信息，并能直接操作任意对象的内部属性及方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class c = Class.forName(<span class="string">&quot;java.lang.String&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>加载完类之后，在堆内存的方法区中就产生了一个Class类型的对象（一个类只有一个Class对象），这</p>
<p>个对象就包含了完整的类的结构信息。我们可以通过这个对象看到类的结构。这个对象就像一面镜子，</p>
<p>透过这个镜子看到类的结构，所以，我们形象的称之为：<strong>反射</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//什么叫反射</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">test</span> <span class="keyword">extends</span> <span class="title">Object</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</span><br><span class="line">        Class c1 = Class.forName(<span class="string">&quot;User&quot;</span>);</span><br><span class="line">        System.out.println(c1);</span><br><span class="line">        Class c2 = Class.forName(<span class="string">&quot;User&quot;</span>);</span><br><span class="line">        Class c3 = Class.forName(<span class="string">&quot;User&quot;</span>);</span><br><span class="line">        Class c4 = Class.forName(<span class="string">&quot;User&quot;</span>);</span><br><span class="line"><span class="comment">//        一个类在内存中只有一个class对象</span></span><br><span class="line"><span class="comment">//        一个类被加载后,类的整个结构都会被封装在class对象中</span></span><br><span class="line">        System.out.println(c2.hashCode());</span><br><span class="line">        System.out.println(c3.hashCode());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实体类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, <span class="keyword">int</span> id, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/secqin/img/raw/master/Snipaste_2022-02-14_19-16-36.png" alt="Snipaste_2022-02-14_19-16-36"></p>
<h2 id="Getting-started"><a href="#Getting-started" class="headerlink" title="Getting started"></a>Getting started</h2><h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><p>​        To use MyBatis you just need to include the          <a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3/releases">mybatis-x.x.x.jar</a>        file in the classpath.      </p>
<p>​        If you are using Maven just add the following dependency to your pom.xml:      </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Building-SqlSessionFactory-from-XML"><a href="#Building-SqlSessionFactory-from-XML" class="headerlink" title="Building SqlSessionFactory from XML"></a>Building SqlSessionFactory from XML</h3><p>​        Every MyBatis application centers around an instance of        SqlSessionFactory. A SqlSessionFactory instance can be acquired by        using the SqlSessionFactoryBuilder. SqlSessionFactoryBuilder can        build a SqlSessionFactory instance from an XML configuration file,        or from a custom prepared instance of the Configuration class.      </p>
<p>​        Building a SqlSessionFactory instance from an XML file is very        simple. It is recommended that you use a classpath resource for        this configuration, but you could use any InputStream instance,        including one created from a literal file path or a file:// URL.        MyBatis includes a utility class, called Resources, that contains        a number of methods that make it simpler to load resources from        the classpath and other locations.      </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String resource = <span class="string">&quot;org/mybatis/example/mybatis-config.xml&quot;</span>;</span><br><span class="line">InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br></pre></td></tr></table></figure>

<p>​        The configuration XML file contains settings for the core of the        MyBatis system, including a DataSource for acquiring database        Connection instances, as well as a TransactionManager for        determining how transactions should be scoped and controlled. The        full details of the XML configuration file can be found later in        this document, but here is a simple example:      </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/example/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        While there is a lot more to the XML configuration file, the        above example points out the most critical parts. Notice the        XML header, required to validate the XML document. The body        of the environment element contains the environment        configuration for transaction management and connection        pooling. The mappers element contains a list of mappers –        the XML files and/or annotated Java interface classes that        contain the SQL code and mapping definitions.      </p>
<h3 id="Building-SqlSessionFactory-without-XML"><a href="#Building-SqlSessionFactory-without-XML" class="headerlink" title="Building SqlSessionFactory without XML"></a>Building SqlSessionFactory without XML</h3><p>​        If you prefer to directly build the configuration from Java, rather        than XML, or create your own configuration builder, MyBatis provides        a complete Configuration class that provides all of the same        configuration options as the XML file.      </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DataSource dataSource = BlogDataSourceFactory.getBlogDataSource();</span><br><span class="line">TransactionFactory transactionFactory =</span><br><span class="line">  <span class="keyword">new</span> JdbcTransactionFactory();</span><br><span class="line">Environment environment =</span><br><span class="line">  <span class="keyword">new</span> Environment(<span class="string">&quot;development&quot;</span>, transactionFactory, dataSource);</span><br><span class="line">Configuration configuration = <span class="keyword">new</span> Configuration(environment);</span><br><span class="line">configuration.addMapper(BlogMapper.class);</span><br><span class="line">SqlSessionFactory sqlSessionFactory =</span><br><span class="line">  <span class="keyword">new</span> SqlSessionFactoryBuilder().build(configuration);</span><br></pre></td></tr></table></figure>

<p>​        Notice in this case the configuration is adding a mapper class.        Mapper classes are Java classes that        contain SQL Mapping Annotations        that avoid the need for XML. However, due        to some limitations of        Java Annotations and the complexity of some MyBatis mappings, XML        mapping is still required for the        most advanced mappings (e.g.        Nested Join Mapping). For this reason,        MyBatis will automatically        look        for and load a peer XML file if it exists (in this case,        BlogMapper.xml would be loaded based on the        classpath and name of        BlogMapper.class). More on this later.      </p>
<h3 id="Acquiring-a-SqlSession-from-SqlSessionFactory"><a href="#Acquiring-a-SqlSession-from-SqlSessionFactory" class="headerlink" title="Acquiring a SqlSession from SqlSessionFactory"></a>Acquiring a SqlSession from SqlSessionFactory</h3><p>​        Now that you have a SqlSessionFactory, as the name suggests, you        can acquire an instance of        SqlSession. The SqlSession contains absolutely every method needed to execute        SQL commands against        the database. You can execute mapped SQL statements directly against        the SqlSession instance. For        example:      </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlSession session = sqlSessionFactory.openSession()) &#123;</span><br><span class="line">  Blog blog = session.selectOne(</span><br><span class="line">    <span class="string">&quot;org.mybatis.example.BlogMapper.selectBlog&quot;</span>, <span class="number">101</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        While this approach works, and is familiar to users of previous        versions of MyBatis, there is now a        cleaner approach. Using an interface (e.g. BlogMapper.class) that properly        describes the parameter and        return value for a given statement, you can now execute cleaner and more        type safe code, without error        prone string literals and casting.      </p>
<p>​        For example:      </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlSession session = sqlSessionFactory.openSession()) &#123;</span><br><span class="line">  BlogMapper mapper = session.getMapper(BlogMapper.class);</span><br><span class="line">  Blog blog = mapper.selectBlog(<span class="number">101</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        Now let’s explore what exactly is being executed here.      </p>
<h3 id="Exploring-Mapped-SQL-Statements"><a href="#Exploring-Mapped-SQL-Statements" class="headerlink" title="Exploring Mapped SQL Statements"></a>Exploring Mapped SQL Statements</h3><p>​        At this point you may be wondering what exactly is being executed by        the SqlSession or Mapper class. The topic of Mapped SQL Statements        is a big one, and that topic will likely dominate the majority of        this documentation. But to give you an idea of what exactly is being        run, here are a couple of examples.      </p>
<p>​        In either of the examples above, the statements could have been        defined by either XML or Annotations. Let’s take a look at XML        first. The full set of features provided by MyBatis can be realized        by using the XML based mapping language that has made MyBatis        popular over the years. If you’ve used MyBatis before, the concept        will be familiar to you, but there have been numerous improvements        to the XML mapping documents that will become clear later. Here is        an example of an XML based mapped statement that would satisfy the        above SqlSession calls.      </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;org.mybatis.example.BlogMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlog&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span><br><span class="line">    select * from Blog where id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​        While this looks like a lot of overhead for this simple example, it is        actually very light. You can define as many mapped statements in a        single mapper XML file as you like, so you get a lot of mileage out        of the XML header and doctype declaration. The rest of the file is        pretty self explanatory. It defines a name for the mapped statement        “selectBlog”, in the namespace “org.mybatis.example.BlogMapper”,        which would allow you to call it by specifying the fully qualified        name of “org.mybatis.example.BlogMapper.selectBlog”, as we did above        in the following example:      </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Blog blog = session.selectOne(</span><br><span class="line">  <span class="string">&quot;org.mybatis.example.BlogMapper.selectBlog&quot;</span>, <span class="number">101</span>);</span><br></pre></td></tr></table></figure>

<p>​        Notice how similar this is to calling a method on a fully qualified Java        class, and there’s a reason for that. This name can be directly        mapped to a Mapper class of the same name as the namespace, with a        method that matches the name, parameter, and return type as the        mapped select statement. This allows you to very simply call the        method against the Mapper interface as you saw above, but here it is        again in the following example:      </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BlogMapper mapper = session.getMapper(BlogMapper.class);</span><br><span class="line">Blog blog = mapper.selectBlog(<span class="number">101</span>);</span><br></pre></td></tr></table></figure>

<p>​        The second approach has a lot of advantages. First, it doesn’t depend        on a string literal, so it’s much safer. Second, if your IDE has        code completion, you can leverage that when navigating your mapped        SQL statements.      </p>
<hr>
<p>​        NOTE        <strong>A note about namespaces.</strong>      </p>
<p>​        <strong>Namespaces</strong>        were optional in previous versions of MyBatis, which was confusing        and unhelpful. Namespaces are now required and have a purpose beyond        simply isolating statements with longer, fully-qualified names.      </p>
<p>​        Namespaces enable the interface bindings as you see here, and even if you        don’t think you’ll use them today, you should follow these practices        laid out here in case you change your mind. Using the namespace        once, and putting it in a proper Java package namespace will clean        up your code and improve the usability of MyBatis in the long term.      </p>
<p>​        <strong>Name Resolution:</strong> To reduce the amount of typing, MyBatis uses the        following name resolution rules for all named configuration        elements, including statements, result maps, caches, etc.      </p>
<ul>
<li>Fully qualified names (e.g.          “com.mypackage.MyMapper.selectAllThings”) are looked up directly          and used if found.        </li>
<li>Short names (e.g. “selectAllThings”) can be used to reference          any unambiguous entry. However if there are two or more (e.g.          “com.foo.selectAllThings and com.bar.selectAllThings”), then you          will receive an error reporting that the short name is ambiguous          and therefore must be fully qualified.        </li>
</ul>
<hr>
<p>​        There’s one more trick to Mapper classes like BlogMapper. Their mapped        statements don’t need to be mapped with XML at all. Instead they can        use Java Annotations. For example, the XML above could be eliminated        and replaced with:      </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.mybatis.example;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BlogMapper</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Select(&quot;SELECT * FROM blog WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="function">Blog <span class="title">selectBlog</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​        The annotations are a lot cleaner for simple statements, however, Java        Annotations are both limited and messier for more complicated        statements. Therefore, if you have to do anything complicated,        you’re better off with XML mapped statements.      </p>
<p>​        It will be up to you and your project team to determine which is right        for you, and how important it is to you that your mapped statements        be defined in a consistent way. That said, you’re never locked into        a single approach. You can very easily migrate Annotation based        Mapped Statements to XML and vice versa.      </p>
<h3 id="Scope-and-Lifecycle"><a href="#Scope-and-Lifecycle" class="headerlink" title="Scope and Lifecycle"></a>Scope and Lifecycle</h3><p>​        It’s very important to understand the various scopes and lifecycles        classes we’ve discussed so far. Using them incorrectly can cause        severe concurrency problems.      </p>
<hr>
<p>NOTE        <strong>Object lifecycle and Dependency Injection Frameworks</strong>      </p>
<p>​        Dependency Injection frameworks can create thread safe, transactional SqlSessions and mappers        and inject them directly into your beans so you can just forget about their lifecycle.        You may want to have a look at MyBatis-Spring or        MyBatis-Guice sub-projects to know more about using MyBatis with DI frameworks.      </p>
<hr>
<h4 id="SqlSessionFactoryBuilder"><a href="#SqlSessionFactoryBuilder" class="headerlink" title="SqlSessionFactoryBuilder"></a>SqlSessionFactoryBuilder</h4><p>​          This class can be instantiated, used and thrown away. There is no need          to keep it around once you’ve created your SqlSessionFactory.          Therefore the best scope for instances of SqlSessionFactoryBuilder          is method scope (i.e. a local method variable). You can reuse the          SqlSessionFactoryBuilder to build multiple SqlSessionFactory          instances, but it’s still best not to keep it around to ensure that          all of the XML parsing resources are freed up for more important          things.        </p>
<h4 id="SqlSessionFactory"><a href="#SqlSessionFactory" class="headerlink" title="SqlSessionFactory"></a>SqlSessionFactory</h4><p>​          Once created, the SqlSessionFactory should exist for the duration of          your application execution. There should be little or no reason to          ever dispose of it or recreate it. It’s a best practice to not          rebuild the SqlSessionFactory multiple times in an application run.          Doing so should be considered a “bad smell”. Therefore the best          scope of SqlSessionFactory is application scope. This can be          achieved a number of ways. The simplest is to use a Singleton          pattern or Static Singleton pattern.        </p>
<h4 id="SqlSession"><a href="#SqlSession" class="headerlink" title="SqlSession"></a>SqlSession</h4><p>​          Each thread should have its own instance of SqlSession. Instances of          SqlSession are not to be shared and are not thread safe. Therefore          the best scope is request or method scope. Never keep references to          a SqlSession instance in a static field or even an instance field          of a class. Never keep references to a SqlSession in any sort of          managed scope, such as HttpSession of the Servlet framework. If          you’re using a web framework of any sort, consider the SqlSession          to follow a similar scope to that of an HTTP request. In other          words, upon receiving an HTTP request, you can open a SqlSession,          then upon returning the response, you can close it. Closing the          session is very important. You should always ensure that it’s          closed within a finally block. The following is the standard          pattern for ensuring that SqlSessions are closed:        </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlSession session = sqlSessionFactory.openSession()) &#123;</span><br><span class="line">  <span class="comment">// do work</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​          Using this pattern consistently throughout your code will ensure that          all database resources are properly closed.        </p>
<h4 id="Mapper-Instances"><a href="#Mapper-Instances" class="headerlink" title="Mapper Instances"></a>Mapper Instances</h4><p>​          Mappers are interfaces that you create to bind to your mapped statements.          Instances of the mapper interfaces are acquired from the          SqlSession. As such, technically the broadest scope of any mapper          instance is the same as the SqlSession from which they were          requested. However, the best scope for mapper instances is method          scope. That is, they should be requested within the method that          they are used, and then be discarded. They do not need to be closed          explicitly. While it’s not a problem to keep them around throughout          a request, similar to the SqlSession, you might find that managing          too many resources at this level will quickly get out of hand. Keep          it simple, keep Mappers in the method scope. The following example          demonstrates this practice.        </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (SqlSession session = sqlSessionFactory.openSession()) &#123;</span><br><span class="line">  BlogMapper mapper = session.getMapper(BlogMapper.class);</span><br><span class="line">  <span class="comment">// do work</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mybatis"><a href="#mybatis" class="headerlink" title="mybatis"></a>mybatis</h2><p><a target="_blank" rel="noopener" href="https://mybatis.org/"><img src="https://mybatis.org/images/mybatis-logo.png" alt="MyBatis logo"></a></p>
<ul>
<li>Last Published: 26 December 2021|</li>
<li>Version: 3.5.9</li>
</ul>
<p>​     Reference Documentation    <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/index.html">Introduction</a>    <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/getting-started.html">Getting Started</a>    <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#">Configuration XML</a>           <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#properties">properties</a>      <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#settings">settings</a>      <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#typeAliases">typeAliases</a>      <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#typeHandlers">typeHandlers</a>      <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#objectFactory">objectFactory</a>      <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#plugins">plugins</a>      <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#environments">environments</a>      <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#databaseIdProvider">databaseIdProvider</a>      <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#mappers">mappers</a>         <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/sqlmap-xml.html">Mapper XML Files</a>    <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/dynamic-sql.html">Dynamic SQL</a>    <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/java-api.html">Java API</a>    <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/statement-builders.html">SQL Builder Class</a>    <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/logging.html">Logging</a>   Project Documentation    <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/project-info.html">Project Information</a>    <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/project-reports.html">Project Reports</a>            </p>
<hr>
<p><a target="_blank" rel="noopener" href="http://maven.apache.org/"><img src="https://mybatis.org/mybatis-3/images/logos/maven-feather.png" alt="Built by Maven"></a></p>
<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><p>​        The MyBatis configuration contains settings and        properties        that have a dramatic effect on how MyBatis behaves. The        high level        structure of the document is as follows:      </p>
<ul>
<li>​          configuration          <ul>
<li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#properties">properties</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#settings">settings</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#typeAliases">typeAliases</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#typeHandlers">typeHandlers</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#objectFactory">objectFactory</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#plugins">plugins</a></li>
<li>environments<ul>
<li>​                  environment                  <ul>
<li>transactionManager</li>
<li>dataSource</li>
</ul>
</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#databaseIdProvider">databaseIdProvider</a></li>
<li><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#mappers">mappers</a></li>
</ul>
</li>
</ul>
<h3 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h3><p>​          These are externalizable, substitutable properties that can be          configured in a typical Java Properties file instance, or passed in          through sub-elements of the properties element. For example:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties resource=&quot;org/mybatis/example/config.properties&quot;&gt;</span><br><span class="line">  &lt;property name=&quot;username&quot; value=&quot;dev_user&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;password&quot; value=&quot;F2Fa3!33TYyg&quot;/&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>

<p>The properties can then be used throughout the configuration          files          to substitute values that need to be dynamically configured.          For          example:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">  &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt;</span><br><span class="line">&lt;/dataSource&gt;</span><br></pre></td></tr></table></figure>

<p>​          The username and password in this example will be replaced by the          values set in the properties elements. The driver and url          properties          would be replaced with values contained from the          config.properties          file. This provides a lot of options for          configuration.        </p>
<p>​          Properties can also be passed into the SqlSessionFactoryBuilder.build()          methods. For          example:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SqlSessionFactory factory =</span><br><span class="line">  sqlSessionFactoryBuilder.build(reader, props);</span><br><span class="line"></span><br><span class="line">// ... or ...</span><br><span class="line"></span><br><span class="line">SqlSessionFactory factory =</span><br><span class="line">  new SqlSessionFactoryBuilder.build(reader, environment, props);</span><br></pre></td></tr></table></figure>

<p>​          If a property exists in more than one of these places, MyBatis          loads          them in the following order:        </p>
<ul>
<li>Properties specified in the body of the properties element are            read first,          </li>
<li>Properties loaded from the classpath resource or url attributes            of the properties element are read second, and override any            duplicate properties already specified,          </li>
<li>Properties passed as a method parameter are read last, and            override any duplicate properties that may have been loaded from            the properties body and the resource/url attributes.          </li>
</ul>
<p>​          Thus, the highest priority properties are those passed in as a          method          parameter, followed by resource/url attributes and finally          the          properties specified in the body of the properties element.        </p>
<p>​          Since the MyBatis 3.4.2, your can specify a default value into placeholder as follow:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">  &lt;!-- ... --&gt;</span><br><span class="line">  &lt;property name=&quot;username&quot; value=&quot;$&#123;username:ut_user&#125;&quot;/&gt; &lt;!-- If &#x27;username&#x27; property not present, username become &#x27;ut_user&#x27; --&gt;</span><br><span class="line">&lt;/dataSource&gt;</span><br></pre></td></tr></table></figure>

<p>​          This feature is disabled by default. If you specify a default value into placeholder,          you should enable this feature by adding a special property as follow:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties resource=&quot;org/mybatis/example/config.properties&quot;&gt;</span><br><span class="line">  &lt;!-- ... --&gt;</span><br><span class="line">  &lt;property name=&quot;org.apache.ibatis.parsing.PropertyParser.enable-default-value&quot; value=&quot;true&quot;/&gt; &lt;!-- Enable this feature --&gt;</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>

<p>​          NOTE This will conflict with the <code>&quot;:&quot;</code> character in property keys (e.g. <code>db:username</code>)          or the ternary operator of OGNL expressions (e.g. <code>$&#123;tableName != null ? tableName : &#39;global_constants&#39;&#125;</code>) on a SQL definition.          If you use either and want default property values, you must  change the default value separator by adding this special property:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties resource=&quot;org/mybatis/example/config.properties&quot;&gt;</span><br><span class="line">  &lt;!-- ... --&gt;</span><br><span class="line">  &lt;property name=&quot;org.apache.ibatis.parsing.PropertyParser.default-value-separator&quot; value=&quot;?:&quot;/&gt; &lt;!-- Change default value of separator --&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line">&lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">  &lt;!-- ... --&gt;</span><br><span class="line">  &lt;property name=&quot;username&quot; value=&quot;$&#123;db:username?:ut_user&#125;&quot;/&gt;</span><br><span class="line">&lt;/dataSource&gt;</span><br></pre></td></tr></table></figure>

<h3 id="settings"><a href="#settings" class="headerlink" title="settings"></a>settings</h3><p>​          These are extremely important tweaks that modify the way that          MyBatis          behaves at runtime. The following table describes the          settings,          their meanings and their default values.        </p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Description</th>
<th>Valid Values</th>
<th>Default</th>
</tr>
</thead>
<tbody><tr>
<td>cacheEnabled</td>
<td>Globally enables or disables any                caches configured in any                mapper under this configuration.</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>lazyLoadingEnabled</td>
<td>Globally enables or disables lazy loading. When enabled, all relations will be lazily loaded.                This value can be superseded for a specific relation by using the <code>fetchType</code> attribute on it.</td>
<td>true | false</td>
<td>false</td>
</tr>
<tr>
<td>aggressiveLazyLoading</td>
<td>When enabled, any method call will load all the lazy  properties of the object. Otherwise, each property is loaded on demand  (see also <code>lazyLoadTriggerMethods</code>).</td>
<td>true | false</td>
<td>false (true in ≤3.4.1)</td>
</tr>
<tr>
<td>multipleResultSetsEnabled</td>
<td>Allows or disallows multiple                ResultSets to be returned from a                single statement (compatible                driver required).</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>useColumnLabel</td>
<td>Uses the column label instead of                the column name. Different                drivers behave differently in this                respect. Refer to the driver                documentation, or test out both                modes to determine how your                driver                behaves.</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>useGeneratedKeys</td>
<td>Allows JDBC support for generated                keys. A compatible driver is                required. This setting forces                generated keys to be used if set to                true, as some drivers deny                compatibility but still work (e.g.                Derby).</td>
<td>true | false</td>
<td>False</td>
</tr>
<tr>
<td>autoMappingBehavior</td>
<td>Specifies if and how MyBatis                should automatically map columns                to fields/properties.                NONE disables auto-mapping.                PARTIAL will only auto-map results                with no nested result mappings defined inside.                FULL will auto-map result mappings of any                complexity (containing nested or otherwise).</td>
<td>NONE, PARTIAL, FULL</td>
<td>PARTIAL</td>
</tr>
<tr>
<td>autoMappingUnknownColumnBehavior</td>
<td>Specify the behavior when detects an unknown column (or unknown property type) of automatic mapping target.                                    <code>NONE</code>: Do nothing                   <code>WARNING</code>: Output warning log (The log level of <code>&#39;org.apache.ibatis.session.AutoMappingUnknownColumnBehavior&#39;</code> must be set to <code>WARN</code>)                   <code>FAILING</code>: Fail mapping (Throw <code>SqlSessionException</code>)</td>
<td>NONE, WARNING, FAILING</td>
<td>NONE</td>
</tr>
<tr>
<td>defaultExecutorType</td>
<td>Configures the default executor.                SIMPLE executor does nothing                special. REUSE executor reuses                prepared statements. BATCH                executor                reuses statements and                batches updates.</td>
<td>SIMPLE                REUSE                BATCH</td>
<td>SIMPLE</td>
</tr>
<tr>
<td>defaultStatementTimeout</td>
<td>Sets the number of seconds                the driver will wait                for a response from the database.</td>
<td>Any positive integer</td>
<td>Not Set (null)</td>
</tr>
<tr>
<td>defaultFetchSize</td>
<td>Sets the driver a hint as to control fetching size for return results.                This parameter value can be override by a query setting.</td>
<td>Any positive integer</td>
<td>Not Set (null)</td>
</tr>
<tr>
<td>defaultResultSetType</td>
<td>Specifies a scroll strategy when omit it per statement settings. (Since: 3.5.2)</td>
<td>FORWARD_ONLY | SCROLL_SENSITIVE | SCROLL_INSENSITIVE | DEFAULT(same behavior with ‘Not Set’)</td>
<td>Not Set (null)</td>
</tr>
<tr>
<td>safeRowBoundsEnabled</td>
<td>Allows using RowBounds on nested                statements. If allow, set the false.</td>
<td>true | false</td>
<td>False</td>
</tr>
<tr>
<td>safeResultHandlerEnabled</td>
<td>Allows using ResultHandler on nested statements.                If allow, set the false.</td>
<td>true | false</td>
<td>True</td>
</tr>
<tr>
<td>mapUnderscoreToCamelCase</td>
<td>Enables automatic mapping from                classic database column names                A_COLUMN to camel case classic Java                property names aColumn.</td>
<td>true | false</td>
<td>False</td>
</tr>
<tr>
<td>localCacheScope</td>
<td>MyBatis uses local cache to prevent circular references  and speed up repeated nested queries.                By default (SESSION) all queries executed during a  session are cached. If localCacheScope=STATEMENT local session will be  used just for                statement execution, no data will be shared between two  different calls to the same SqlSession.</td>
<td>SESSION | STATEMENT</td>
<td>SESSION</td>
</tr>
<tr>
<td>jdbcTypeForNull</td>
<td>Specifies the JDBC type for null values when no specific JDBC type was provided for the parameter.                Some drivers require specifying the column JDBC type but others work with generic values like NULL, VARCHAR or OTHER.</td>
<td>JdbcType enumeration. Most common are: NULL, VARCHAR and OTHER</td>
<td>OTHER</td>
</tr>
<tr>
<td>lazyLoadTriggerMethods</td>
<td>Specifies which Object’s methods trigger a lazy load</td>
<td>A method name list separated by commas</td>
<td>equals,clone,hashCode,toString</td>
</tr>
<tr>
<td>defaultScriptingLanguage</td>
<td>Specifies the language used by default for dynamic SQL generation.</td>
<td>A type alias or fully qualified class name.</td>
<td>org.apache.ibatis.scripting.xmltags.XMLLanguageDriver</td>
</tr>
<tr>
<td>defaultEnumTypeHandler</td>
<td>Specifies the <code>TypeHandler</code> used by default for Enum. (Since: 3.4.5)</td>
<td>A type alias or fully qualified class name.</td>
<td>org.apache.ibatis.type.EnumTypeHandler</td>
</tr>
<tr>
<td>callSettersOnNulls</td>
<td>Specifies if setters or map’s put method will be called  when a retrieved value is null. It is useful when you rely on  Map.keySet() or null value initialization. Note primitives such as  (int,boolean,etc.) will not be set to null.</td>
<td>true | false</td>
<td>false</td>
</tr>
<tr>
<td>returnInstanceForEmptyRow</td>
<td>MyBatis, by default, returns <code>null</code> when all the columns of a returned row are NULL.                When this setting is enabled, MyBatis returns an empty instance instead.                Note that it is also applied to nested results (i.e. collectioin and association). Since: 3.4.2</td>
<td>true | false</td>
<td>false</td>
</tr>
<tr>
<td>logPrefix</td>
<td>Specifies the prefix string that MyBatis will add to the logger names.</td>
<td>Any String</td>
<td>Not set</td>
</tr>
<tr>
<td>logImpl</td>
<td>Specifies which logging implementation MyBatis should  use. If this setting is not present logging implementation will be  autodiscovered.</td>
<td>SLF4J | LOG4J(deprecated since 3.5.9) | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING</td>
<td>Not set</td>
</tr>
<tr>
<td>proxyFactory</td>
<td>Specifies the proxy tool that MyBatis will use for creating lazy loading capable objects.</td>
<td>CGLIB | JAVASSIST</td>
<td>JAVASSIST (MyBatis 3.3 or above)</td>
</tr>
<tr>
<td>vfsImpl</td>
<td>Specifies VFS implementations</td>
<td>Fully qualified class names of custom VFS implementation separated by commas.</td>
<td>Not set</td>
</tr>
<tr>
<td>useActualParamName</td>
<td>Allow referencing statement parameters by their actual names declared in the method signature.                To use this feature, your project must be compiled in Java 8 with <code>-parameters</code> option. (Since: 3.4.1)</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>configurationFactory</td>
<td>Specifies the class that provides an instance of <code>Configuration</code>.                The returned Configuration instance is used to load lazy properties of deserialized objects.                This class must have a method with a signature <code>static Configuration getConfiguration()</code>. (Since: 3.2.3)</td>
<td>A type alias or fully qualified class name.</td>
<td>Not set</td>
</tr>
<tr>
<td>shrinkWhitespacesInSql</td>
<td>Removes extra whitespace characters from the SQL. Note  that this also affects literal strings in SQL. (Since 3.5.5)</td>
<td>true | false</td>
<td>false</td>
</tr>
<tr>
<td>defaultSqlProviderType</td>
<td>Specifies an sql provider class that holds provider method (Since 3.5.6).                This class apply to the <code>type</code>(or <code>value</code>) attribute on sql provider annotation(e.g. <code>@SelectProvider</code>),                when these attribute was omitted.</td>
<td>A type alias or fully qualified class name</td>
<td>Not set</td>
</tr>
<tr>
<td>nullableOnForEach</td>
<td>Specifies the default value of ‘nullable’ attribute on ‘foreach’ tag. (Since 3.5.9)</td>
<td>true | false</td>
<td>false</td>
</tr>
</tbody></table>
<p>​          An example of the settings element fully configured is as follows:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">  &lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;multipleResultSetsEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;useColumnLabel&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;useGeneratedKeys&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;autoMappingBehavior&quot; value=&quot;PARTIAL&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;autoMappingUnknownColumnBehavior&quot; value=&quot;WARNING&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;defaultExecutorType&quot; value=&quot;SIMPLE&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;defaultStatementTimeout&quot; value=&quot;25&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;defaultFetchSize&quot; value=&quot;100&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;safeRowBoundsEnabled&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;localCacheScope&quot; value=&quot;SESSION&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;OTHER&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;lazyLoadTriggerMethods&quot;</span><br><span class="line">    value=&quot;equals,clone,hashCode,toString&quot;/&gt;</span><br><span class="line">&lt;/settings&gt;</span><br></pre></td></tr></table></figure>

<h3 id="typeAliases"><a href="#typeAliases" class="headerlink" title="typeAliases"></a>typeAliases</h3><p>​          A type alias is simply a shorter name for a Java type. It’s only          relevant to the XML configuration and simply exists to reduce          redundant typing of fully qualified classnames. For example:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Author&quot; type=&quot;domain.blog.Author&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Blog&quot; type=&quot;domain.blog.Blog&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Comment&quot; type=&quot;domain.blog.Comment&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Post&quot; type=&quot;domain.blog.Post&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Section&quot; type=&quot;domain.blog.Section&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Tag&quot; type=&quot;domain.blog.Tag&quot;/&gt;</span><br><span class="line">&lt;/typeAliases&gt;</span><br></pre></td></tr></table></figure>

<p>​          With this configuration,          <code>Blog</code>          can now be used anywhere that          <code>domain.blog.Blog</code>          could be.        </p>
<p> You can also specify a package where MyBatis will search for          beans. For example:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeAliases&gt;</span><br><span class="line">  &lt;package name=&quot;domain.blog&quot;/&gt;</span><br><span class="line">&lt;/typeAliases&gt;</span><br></pre></td></tr></table></figure>

<p>​          Each bean found in          <code>domain.blog</code>          , if no annotation is found,          will be registered as an alias          using          uncapitalized non-qualified class name of the bean. That is          <code>domain.blog.Author</code>          will be registered as          <code>author</code>. If the          <code>@Alias</code>          annotation is found its value will          be used as an alias. See the example below:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Alias(&quot;author&quot;)</span><br><span class="line">public class Author &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​          There are many built-in type aliases for common Java types. They          are all          case insensitive, note the special handling of primitives          due          to the overloaded names.        </p>
<table>
<thead>
<tr>
<th>Alias</th>
<th>Mapped Type</th>
</tr>
</thead>
<tbody><tr>
<td>_byte</td>
<td>byte</td>
</tr>
<tr>
<td>_long</td>
<td>long</td>
</tr>
<tr>
<td>_short</td>
<td>short</td>
</tr>
<tr>
<td>_int</td>
<td>int</td>
</tr>
<tr>
<td>_integer</td>
<td>int</td>
</tr>
<tr>
<td>_double</td>
<td>double</td>
</tr>
<tr>
<td>_float</td>
<td>float</td>
</tr>
<tr>
<td>_boolean</td>
<td>boolean</td>
</tr>
<tr>
<td>string</td>
<td>String</td>
</tr>
<tr>
<td>byte</td>
<td>Byte</td>
</tr>
<tr>
<td>long</td>
<td>Long</td>
</tr>
<tr>
<td>short</td>
<td>Short</td>
</tr>
<tr>
<td>int</td>
<td>Integer</td>
</tr>
<tr>
<td>integer</td>
<td>Integer</td>
</tr>
<tr>
<td>double</td>
<td>Double</td>
</tr>
<tr>
<td>float</td>
<td>Float</td>
</tr>
<tr>
<td>boolean</td>
<td>Boolean</td>
</tr>
<tr>
<td>date</td>
<td>Date</td>
</tr>
<tr>
<td>decimal</td>
<td>BigDecimal</td>
</tr>
<tr>
<td>bigdecimal</td>
<td>BigDecimal</td>
</tr>
<tr>
<td>object</td>
<td>Object</td>
</tr>
<tr>
<td>map</td>
<td>Map</td>
</tr>
<tr>
<td>hashmap</td>
<td>HashMap</td>
</tr>
<tr>
<td>list</td>
<td>List</td>
</tr>
<tr>
<td>arraylist</td>
<td>ArrayList</td>
</tr>
<tr>
<td>collection</td>
<td>Collection</td>
</tr>
<tr>
<td>iterator</td>
<td>Iterator</td>
</tr>
</tbody></table>
<h3 id="typeHandlers"><a href="#typeHandlers" class="headerlink" title="typeHandlers"></a>typeHandlers</h3><p>​          Whenever MyBatis sets a parameter on a PreparedStatement or          retrieves a          value from a ResultSet, a TypeHandler is used to retrieve          the value          in a means appropriate to the Java type. The following          table          describes the default TypeHandlers.        </p>
<p>​          NOTE          Since version 3.4.5, MyBatis supports JSR-310 (Date and Time API) by default.        </p>
<table>
<thead>
<tr>
<th>Type Handler</th>
<th>Java Types</th>
<th>JDBC Types</th>
</tr>
</thead>
<tbody><tr>
<td><code>BooleanTypeHandler</code></td>
<td><code>java.lang.Boolean</code>, <code>boolean</code></td>
<td>Any compatible <code>BOOLEAN</code></td>
</tr>
<tr>
<td><code>ByteTypeHandler</code></td>
<td><code>java.lang.Byte</code>, <code>byte</code></td>
<td>Any compatible <code>NUMERIC</code> or <code>BYTE</code></td>
</tr>
<tr>
<td><code>ShortTypeHandler</code></td>
<td><code>java.lang.Short</code>, <code>short</code></td>
<td>Any compatible <code>NUMERIC</code> or <code>SMALLINT</code></td>
</tr>
<tr>
<td><code>IntegerTypeHandler</code></td>
<td><code>java.lang.Integer</code>, <code>int</code></td>
<td>Any compatible <code>NUMERIC</code> or <code>INTEGER</code></td>
</tr>
<tr>
<td><code>LongTypeHandler</code></td>
<td><code>java.lang.Long</code>, <code>long</code></td>
<td>Any compatible <code>NUMERIC</code> or <code>BIGINT</code></td>
</tr>
<tr>
<td><code>FloatTypeHandler</code></td>
<td><code>java.lang.Float</code>, <code>float</code></td>
<td>Any compatible <code>NUMERIC</code> or <code>FLOAT</code></td>
</tr>
<tr>
<td><code>DoubleTypeHandler</code></td>
<td><code>java.lang.Double</code>, <code>double</code></td>
<td>Any compatible <code>NUMERIC</code> or <code>DOUBLE</code></td>
</tr>
<tr>
<td><code>BigDecimalTypeHandler</code></td>
<td><code>java.math.BigDecimal</code></td>
<td>Any compatible <code>NUMERIC</code> or <code>DECIMAL</code></td>
</tr>
<tr>
<td><code>StringTypeHandler</code></td>
<td><code>java.lang.String</code></td>
<td><code>CHAR</code>, <code>VARCHAR</code></td>
</tr>
<tr>
<td><code>ClobReaderTypeHandler</code></td>
<td><code>java.io.Reader</code></td>
<td>-</td>
</tr>
<tr>
<td><code>ClobTypeHandler</code></td>
<td><code>java.lang.String</code></td>
<td><code>CLOB</code>, <code>LONGVARCHAR</code></td>
</tr>
<tr>
<td><code>NStringTypeHandler</code></td>
<td><code>java.lang.String</code></td>
<td><code>NVARCHAR</code>, <code>NCHAR</code></td>
</tr>
<tr>
<td><code>NClobTypeHandler</code></td>
<td><code>java.lang.String</code></td>
<td><code>NCLOB</code></td>
</tr>
<tr>
<td><code>BlobInputStreamTypeHandler</code></td>
<td><code>java.io.InputStream</code></td>
<td>-</td>
</tr>
<tr>
<td><code>ByteArrayTypeHandler</code></td>
<td><code>byte[]</code></td>
<td>Any compatible byte stream type</td>
</tr>
<tr>
<td><code>BlobTypeHandler</code></td>
<td><code>byte[]</code></td>
<td><code>BLOB</code>, <code>LONGVARBINARY</code></td>
</tr>
<tr>
<td><code>DateTypeHandler</code></td>
<td><code>java.util.Date</code></td>
<td><code>TIMESTAMP</code></td>
</tr>
<tr>
<td><code>DateOnlyTypeHandler</code></td>
<td><code>java.util.Date</code></td>
<td><code>DATE</code></td>
</tr>
<tr>
<td><code>TimeOnlyTypeHandler</code></td>
<td><code>java.util.Date</code></td>
<td><code>TIME</code></td>
</tr>
<tr>
<td><code>SqlTimestampTypeHandler</code></td>
<td><code>java.sql.Timestamp</code></td>
<td><code>TIMESTAMP</code></td>
</tr>
<tr>
<td><code>SqlDateTypeHandler</code></td>
<td><code>java.sql.Date</code></td>
<td><code>DATE</code></td>
</tr>
<tr>
<td><code>SqlTimeTypeHandler</code></td>
<td><code>java.sql.Time</code></td>
<td><code>TIME</code></td>
</tr>
<tr>
<td><code>ObjectTypeHandler</code></td>
<td>Any</td>
<td><code>OTHER</code>, or unspecified</td>
</tr>
<tr>
<td><code>EnumTypeHandler</code></td>
<td>Enumeration Type</td>
<td><code>VARCHAR</code> any string compatible type, as the code is stored (not  index).</td>
</tr>
<tr>
<td><code>EnumOrdinalTypeHandler</code></td>
<td>Enumeration Type</td>
<td>Any compatible <code>NUMERIC</code> or <code>DOUBLE</code>, as the position is stored                (not the code itself).</td>
</tr>
<tr>
<td><code>SqlxmlTypeHandler</code></td>
<td><code>java.lang.String</code></td>
<td><code>SQLXML</code></td>
</tr>
<tr>
<td><code>InstantTypeHandler</code></td>
<td><code>java.time.Instant</code></td>
<td><code>TIMESTAMP</code></td>
</tr>
<tr>
<td><code>LocalDateTimeTypeHandler</code></td>
<td><code>java.time.LocalDateTime</code></td>
<td><code>TIMESTAMP</code></td>
</tr>
<tr>
<td><code>LocalDateTypeHandler</code></td>
<td><code>java.time.LocalDate</code></td>
<td><code>DATE</code></td>
</tr>
<tr>
<td><code>LocalTimeTypeHandler</code></td>
<td><code>java.time.LocalTime</code></td>
<td><code>TIME</code></td>
</tr>
<tr>
<td><code>OffsetDateTimeTypeHandler</code></td>
<td><code>java.time.OffsetDateTime</code></td>
<td><code>TIMESTAMP</code></td>
</tr>
<tr>
<td><code>OffsetTimeTypeHandler</code></td>
<td><code>java.time.OffsetTime</code></td>
<td><code>TIME</code></td>
</tr>
<tr>
<td><code>ZonedDateTimeTypeHandler</code></td>
<td><code>java.time.ZonedDateTime</code></td>
<td><code>TIMESTAMP</code></td>
</tr>
<tr>
<td><code>YearTypeHandler</code></td>
<td><code>java.time.Year</code></td>
<td><code>INTEGER</code></td>
</tr>
<tr>
<td><code>MonthTypeHandler</code></td>
<td><code>java.time.Month</code></td>
<td><code>INTEGER</code></td>
</tr>
<tr>
<td><code>YearMonthTypeHandler</code></td>
<td><code>java.time.YearMonth</code></td>
<td><code>VARCHAR</code> or <code>LONGVARCHAR</code></td>
</tr>
<tr>
<td><code>JapaneseDateTypeHandler</code></td>
<td><code>java.time.chrono.JapaneseDate</code></td>
<td><code>DATE</code></td>
</tr>
</tbody></table>
<p>​          You can override the type handlers or create your own to deal with          unsupported or non-standard types. To do so, implement the interface <code>org.apache.ibatis.type.TypeHandler</code>          or extend the convenience class <code>org.apache.ibatis.type.BaseTypeHandler</code>          and optionally map it to a JDBC type. For example:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// ExampleTypeHandler.java</span><br><span class="line">@MappedJdbcTypes(JdbcType.VARCHAR)</span><br><span class="line">public class ExampleTypeHandler extends BaseTypeHandler&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public void setNonNullParameter(PreparedStatement ps, int i,</span><br><span class="line">    String parameter, JdbcType jdbcType) throws SQLException &#123;</span><br><span class="line">    ps.setString(i, parameter);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public String getNullableResult(ResultSet rs, String columnName)</span><br><span class="line">    throws SQLException &#123;</span><br><span class="line">    return rs.getString(columnName);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public String getNullableResult(ResultSet rs, int columnIndex)</span><br><span class="line">    throws SQLException &#123;</span><br><span class="line">    return rs.getString(columnIndex);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public String getNullableResult(CallableStatement cs, int columnIndex)</span><br><span class="line">    throws SQLException &#123;</span><br><span class="line">    return cs.getString(columnIndex);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;!-- mybatis-config.xml --&gt;</span><br><span class="line">&lt;typeHandlers&gt;</span><br><span class="line">  &lt;typeHandler handler=&quot;org.mybatis.example.ExampleTypeHandler&quot;/&gt;</span><br><span class="line">&lt;/typeHandlers&gt;</span><br></pre></td></tr></table></figure>

<p>​          Using such a TypeHandler would override the existing type handler          for Java String properties and VARCHAR parameters and results. Note          that MyBatis does not introspect upon the database metadata to          determine the type, so you must specify that it’s a VARCHAR field          in the parameter and result mappings to hook in the correct type          handler. This is due to the fact that MyBatis is unaware of the          data type until the statement is executed.        </p>
<p>​          MyBatis will know the Java type that you want to handle with          this TypeHandler by introspecting its generic type, but          you can override this behavior by two means:        </p>
<ul>
<li>Adding a <code>javaType</code> attribute to the typeHandler element (for example: <code>javaType=&quot;String&quot;</code>)          </li>
<li>Adding a <code>@MappedTypes</code> annotation to your TypeHandler class specifying          the list of java types to associate it with. This annotation will be ignored if          the <code>javaType</code> attribute as also been specified.          </li>
</ul>
<p>The associated JDBC type can be specified by two means:</p>
<ul>
<li>​           Adding a <code>jdbcType</code> attribute to the typeHandler element (for example: <code>jdbcType=&quot;VARCHAR&quot;</code>).          </li>
<li>Adding a <code>@MappedJdbcTypes</code> annotation to your TypeHandler class specifying          the list of JDBC types to associate it with. This annotation will be ignored if          the <code>jdbcType</code> attribute as also been specified.          </li>
</ul>
<p>​          When deciding which TypeHandler to use in a <code>ResultMap</code>, the Java type is known          (from the result type), but the JDBC type is unknown. MyBatis therefore uses the combination          <code>javaType=[TheJavaType], jdbcType=null</code> to choose a TypeHandler. This means that          using a <code>@MappedJdbcTypes</code> annotation <em>restricts</em> the scope of a TypeHandler          and makes it unavailable for use in <code>ResultMap</code>s unless explicity set. To make a          TypeHandler available for use in a <code>ResultMap</code>, set <code>includeNullJdbcType=true</code>          on the <code>@MappedJdbcTypes</code> annotation. Since Mybatis 3.4.0 however, if a <strong>single</strong>          TypeHandler is registered to handle a Java type, it will be used by default in <code>ResultMap</code>s          using this Java type (i.e. even without <code>includeNullJdbcType=true</code>).        </p>
<p>And finally you can let MyBatis search for your TypeHandlers:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- mybatis-config.xml --&gt;</span><br><span class="line">&lt;typeHandlers&gt;</span><br><span class="line">  &lt;package name=&quot;org.mybatis.example&quot;/&gt;</span><br><span class="line">&lt;/typeHandlers&gt;</span><br></pre></td></tr></table></figure>

<p>​          Note that when using the autodiscovery feature JDBC types can only be          specified with annotations.        </p>
<p>​          You can create a generic TypeHandler that is able to handle more than one class. For that purpose          add a constructor that receives the class as a parameter and MyBatis will pass the actual class when          constructing the TypeHandler.        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//GenericTypeHandler.java</span><br><span class="line">public class GenericTypeHandler&lt;E extends MyObject&gt; extends BaseTypeHandler&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">  private Class&lt;E&gt; type;</span><br><span class="line"></span><br><span class="line">  public GenericTypeHandler(Class&lt;E&gt; type) &#123;</span><br><span class="line">    if (type == null) throw new IllegalArgumentException(&quot;Type argument cannot be null&quot;);</span><br><span class="line">    this.type = type;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>

<p><code>EnumTypeHandler</code> and <code>EnumOrdinalTypeHandler</code> are generic TypeHandlers. We will learn        about them in the following section.        </p>
<h3 id="Handling-Enums"><a href="#Handling-Enums" class="headerlink" title="Handling Enums"></a>Handling Enums</h3><p>​            If you want to map an <code>Enum</code>, you’ll need to use either            <code>EnumTypeHandler</code> or <code>EnumOrdinalTypeHandler</code>.          </p>
<p>For example, let’s say that we need to store the rounding mode that          should be used with some number if it needs to be rounded. By default, MyBatis          uses <code>EnumTypeHandler</code> to convert the <code>Enum</code>          values to their names.          </p>
<p><strong>Note <code>EnumTypeHandler</code> is special in the sense that unlike other handlers,          it does not handle just one specific class, but any class that extends <code>Enum</code></strong></p>
<p>However, we may not want to store names. Our DBA may insist on an          integer code instead. That’s just as easy: add <code>EnumOrdinalTypeHandler</code>          to the <code>typeHandlers</code> in your config file, and now each          <code>RoundingMode</code> will be mapped to an integer using its ordinal value.          </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- mybatis-config.xml --&gt;</span><br><span class="line">&lt;typeHandlers&gt;</span><br><span class="line">  &lt;typeHandler handler=&quot;org.apache.ibatis.type.EnumOrdinalTypeHandler&quot;</span><br><span class="line">    javaType=&quot;java.math.RoundingMode&quot;/&gt;</span><br><span class="line">&lt;/typeHandlers&gt;</span><br></pre></td></tr></table></figure>

<p>​          But what if you want to map the same <code>Enum</code> to a          string in one place and to integer in another?        </p>
<p>​            The auto-mapper will automatically use <code>EnumOrdinalTypeHandler</code>,            so if we want to go back to using plain old ordinary            <code>EnumTypeHandler</code>, we have to tell it, by explicitly setting            the type handler to use for those SQL statements.          </p>
<p>​            (Mapper files aren’t covered until the next section, so if this is your first            time reading through the documentation, you may want to skip this for now            and come back to it later.)          </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">    PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">    &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;mapper namespace=&quot;org.apache.ibatis.submitted.rounding.Mapper&quot;&gt;</span><br><span class="line">    &lt;resultMap type=&quot;org.apache.ibatis.submitted.rounding.User&quot; id=&quot;usermap&quot;&gt;</span><br><span class="line">        &lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt;</span><br><span class="line">        &lt;result column=&quot;name&quot; property=&quot;name&quot;/&gt;</span><br><span class="line">        &lt;result column=&quot;funkyNumber&quot; property=&quot;funkyNumber&quot;/&gt;</span><br><span class="line">        &lt;result column=&quot;roundingMode&quot; property=&quot;roundingMode&quot;/&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;select id=&quot;getUser&quot; resultMap=&quot;usermap&quot;&gt;</span><br><span class="line">        select * from users</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    &lt;insert id=&quot;insert&quot;&gt;</span><br><span class="line">        insert into users (id, name, funkyNumber, roundingMode) values (</span><br><span class="line">            #&#123;id&#125;, #&#123;name&#125;, #&#123;funkyNumber&#125;, #&#123;roundingMode&#125;</span><br><span class="line">        )</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">    &lt;resultMap type=&quot;org.apache.ibatis.submitted.rounding.User&quot; id=&quot;usermap2&quot;&gt;</span><br><span class="line">        &lt;id column=&quot;id&quot; property=&quot;id&quot;/&gt;</span><br><span class="line">        &lt;result column=&quot;name&quot; property=&quot;name&quot;/&gt;</span><br><span class="line">        &lt;result column=&quot;funkyNumber&quot; property=&quot;funkyNumber&quot;/&gt;</span><br><span class="line">        &lt;result column=&quot;roundingMode&quot; property=&quot;roundingMode&quot;</span><br><span class="line">         typeHandler=&quot;org.apache.ibatis.type.EnumTypeHandler&quot;/&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">    &lt;select id=&quot;getUser2&quot; resultMap=&quot;usermap2&quot;&gt;</span><br><span class="line">        select * from users2</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    &lt;insert id=&quot;insert2&quot;&gt;</span><br><span class="line">        insert into users2 (id, name, funkyNumber, roundingMode) values (</span><br><span class="line">            #&#123;id&#125;, #&#123;name&#125;, #&#123;funkyNumber&#125;, #&#123;roundingMode, typeHandler=org.apache.ibatis.type.EnumTypeHandler&#125;</span><br><span class="line">        )</span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<p>​          Note that this forces us to use a <code>resultMap</code>          instead of a <code>resultType</code> in our select statements.        </p>
<h3 id="objectFactory"><a href="#objectFactory" class="headerlink" title="objectFactory"></a>objectFactory</h3><p>​          Each time MyBatis creates a new instance of a result object, it          uses an          ObjectFactory instance to do so. The default ObjectFactory          does          little more than instantiate the target class with a default          constructor, or a parameterized constructor if parameter mappings          exist. If you want to override the default behaviour of the          ObjectFactory, you can create your own. For example:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// ExampleObjectFactory.java</span><br><span class="line">public class ExampleObjectFactory extends DefaultObjectFactory &#123;</span><br><span class="line">  @Override</span><br><span class="line">  public &lt;T&gt; T create(Class&lt;T&gt; type) &#123;</span><br><span class="line">    return super.create(type);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public &lt;T&gt; T create(Class&lt;T&gt; type, List&lt;Class&lt;?&gt;&gt; constructorArgTypes, List&lt;Object&gt; constructorArgs) &#123;</span><br><span class="line">    return super.create(type, constructorArgTypes, constructorArgs);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public void setProperties(Properties properties) &#123;</span><br><span class="line">    super.setProperties(properties);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public &lt;T&gt; boolean isCollection(Class&lt;T&gt; type) &#123;</span><br><span class="line">    return Collection.class.isAssignableFrom(type);</span><br><span class="line">  &#125;&#125;</span><br><span class="line">&lt;!-- mybatis-config.xml --&gt;</span><br><span class="line">&lt;objectFactory type=&quot;org.mybatis.example.ExampleObjectFactory&quot;&gt;</span><br><span class="line">  &lt;property name=&quot;someProperty&quot; value=&quot;100&quot;/&gt;</span><br><span class="line">&lt;/objectFactory&gt;</span><br></pre></td></tr></table></figure>

<p>​          The ObjectFactory interface is very simple. It contains two create          methods, one to deal with the default constructor, and the other to          deal with parameterized constructors. Finally, the setProperties          method can be used to configure the ObjectFactory. Properties          defined within the body of the objectFactory element will be passed          to the setProperties method after initialization of your          ObjectFactory instance.        </p>
<h3 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h3><p>​          MyBatis allows you to intercept calls to at certain points within          the          execution of a mapped statement. By default, MyBatis allows          plug-ins to intercept method calls of:        </p>
<ul>
<li>​            Executor            (update, query, flushStatements, commit, rollback,            getTransaction, close,            isClosed)          </li>
<li>​            ParameterHandler            (getParameterObject, setParameters)          </li>
<li>​            ResultSetHandler            (handleResultSets, handleOutputParameters)          </li>
<li>​            StatementHandler            (prepare, parameterize, batch, update, query)          </li>
</ul>
<p>​          The details of these classes methods can be discovered by looking          at          the full method signature of each, and the source code which is          available with each MyBatis release. You should understand the          behaviour of the method you’re overriding, assuming you’re doing          something more than just monitoring calls. If you attempt to modify          or override the behaviour of a given method, you’re likely to break          the core of MyBatis. These are low level classes and methods, so          use          plug-ins with caution.        </p>
<p>​          Using plug-ins is pretty simple given the power they provide.          Simply          implement the Interceptor interface, being sure to specify the          signatures you want to intercept.        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">// ExamplePlugin.java</span><br><span class="line">@Intercepts(&#123;@Signature(</span><br><span class="line">  type= Executor.class,</span><br><span class="line">  method = &quot;update&quot;,</span><br><span class="line">  args = &#123;MappedStatement.class,Object.class&#125;)&#125;)</span><br><span class="line">public class ExamplePlugin implements Interceptor &#123;</span><br><span class="line">  private Properties properties = new Properties();</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public Object intercept(Invocation invocation) throws Throwable &#123;</span><br><span class="line">    // implement pre-processing if needed</span><br><span class="line">    Object returnObject = invocation.proceed();</span><br><span class="line">    // implement post-processing if needed</span><br><span class="line">    return returnObject;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public void setProperties(Properties properties) &#123;</span><br><span class="line">    this.properties = properties;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;!-- mybatis-config.xml --&gt;</span><br><span class="line">&lt;plugins&gt;</span><br><span class="line">  &lt;plugin interceptor=&quot;org.mybatis.example.ExamplePlugin&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;someProperty&quot; value=&quot;100&quot;/&gt;</span><br><span class="line">  &lt;/plugin&gt;</span><br><span class="line">&lt;/plugins&gt;</span><br></pre></td></tr></table></figure>

<p>​          The plug-in above will intercept all calls to the “update” method          on          the Executor instance, which is an internal object responsible for          the low-level execution of mapped statements.        </p>
<p>NOTE          <strong>Overriding the Configuration Class</strong>                  </p>
<p>​          In addition to modifying core MyBatis behaviour with plugins, you          can          also override the <code>Configuration</code> class entirely. Simply extend it          and override any methods inside, and pass it into the call to the          <code>SqlSessionFactoryBuilder.build(myConfig)</code> method. Again though, this          could have a severe impact on the behaviour of MyBatis, so use          caution.        </p>
<h3 id="environments"><a href="#environments" class="headerlink" title="environments"></a>environments</h3><p>​          MyBatis can be configured with multiple environments. This helps          you to          apply your SQL Maps to multiple databases for any number of          reasons. For example, you might have a different configuration for          your Development, Test and Production environments. Or, you may          have          multiple production databases that share the same schema, and          you’d          like to use the same SQL maps for both. There are many use          cases.        </p>
<p>​          <strong>One important thing to remember though: While you can            configure multiple environments, you can only choose ONE per            SqlSessionFactory instance.</strong>                  </p>
<p>​          So if you want to connect to two databases, you need to create two          instances of SqlSessionFactory, one for each. For three databases,          you’d need three instances, and so on. It’s really easy to          remember:        </p>
<ul>
<li>​            <strong>One SqlSessionFactory instance per database</strong>                      </li>
</ul>
<p>​          To specify which environment to build, you simply pass it to the          SqlSessionFactoryBuilder as an optional parameter. The two          signatures that accept the environment are:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(reader, environment);</span><br><span class="line">SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(reader, environment, properties);</span><br></pre></td></tr></table></figure>

<p>If the environment is omitted, then the default environment is          loaded, as follows:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(reader);</span><br><span class="line">SqlSessionFactory factory = new SqlSessionFactoryBuilder().build(reader, properties);</span><br></pre></td></tr></table></figure>

<p>The environments element defines how the environment is          configured.        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;environments default=&quot;development&quot;&gt;</span><br><span class="line">  &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line">    &lt;transactionManager type=&quot;JDBC&quot;&gt;</span><br><span class="line">      &lt;property name=&quot;...&quot; value=&quot;...&quot;/&gt;</span><br><span class="line">    &lt;/transactionManager&gt;</span><br><span class="line">    &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">      &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot;/&gt;</span><br><span class="line">      &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt;</span><br><span class="line">      &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt;</span><br><span class="line">      &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt;</span><br><span class="line">    &lt;/dataSource&gt;</span><br><span class="line">  &lt;/environment&gt;</span><br><span class="line">&lt;/environments&gt;</span><br></pre></td></tr></table></figure>

<p>​          Notice the key sections here:        </p>
<ul>
<li>​            The default Environment ID (e.g. default=”development”).          </li>
<li>​            The Environment ID for each environment defined (e.g.            id=”development”).          </li>
<li>​            The TransactionManager configuration (e.g. type=”JDBC”)          </li>
<li>​            The DataSource configuration (e.g. type=”POOLED”)          </li>
</ul>
<p>​          The default environment and the environment IDs are self          explanatory.          Name them whatever you like, just make sure the default          matches one          of them.        </p>
<p>​          <strong>transactionManager</strong>        </p>
<p>​          There are two TransactionManager types (i.e.          type=”[JDBC|MANAGED]”) that          are included with MyBatis:        </p>
<ul>
<li><p>​            JDBC – This configuration simply makes use of the JDBC commit            and            rollback facilities directly. It relies on the connection            retrieved from the dataSource to manage the scope of the            transaction.          </p>
</li>
<li><p>​            MANAGED – This configuration simply does almost nothing. It            never            commits, or rolls back a connection. Instead, it lets the            container manage the full lifecycle of the transaction (e.g.            a JEE Application Server context). By default it does            close the connection. However, some containers don’t expect this,            and thus if you need to stop it from closing the connection, set            the “closeConnection” property to false. For example:            </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;transactionManager type=&quot;MANAGED&quot;&gt;</span><br><span class="line">  &lt;property name=&quot;closeConnection&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">&lt;/transactionManager&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>​          NOTE          If you are planning to use MyBatis with Spring there is no need to configure          any TransactionManager because the Spring module will set its own one          overriding any previously set configuration.        </p>
<p>​          Neither of these TransactionManager types require any properties.          However,          they are both Type Aliases, so in other words, instead of          using          them, you could put your own fully qualified class name or Type          Alias that refers to your own implementation of the          TransactionFactory interface.        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public interface TransactionFactory &#123;</span><br><span class="line">  default void setProperties(Properties props) &#123; // Since 3.5.2, change to default method</span><br><span class="line">    // NOP</span><br><span class="line">  &#125;</span><br><span class="line">  Transaction newTransaction(Connection conn);</span><br><span class="line">  Transaction newTransaction(DataSource dataSource, TransactionIsolationLevel level, boolean autoCommit);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​          Any properties configured in the XML will be passed to the          setProperties() method after instantiation. Your implementation          would also need to create a Transaction implementation, which is          also a very simple interface:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public interface Transaction &#123;</span><br><span class="line">  Connection getConnection() throws SQLException;</span><br><span class="line">  void commit() throws SQLException;</span><br><span class="line">  void rollback() throws SQLException;</span><br><span class="line">  void close() throws SQLException;</span><br><span class="line">  Integer getTimeout() throws SQLException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​          Using these two interfaces, you can completely customize how          MyBatis          deals with Transactions.        </p>
<p>​          <strong>dataSource</strong>        </p>
<p>​          The dataSource element configures the source of JDBC Connection          objects using the standard JDBC DataSource interface.        </p>
<p>​          Most MyBatis applications will configure a dataSource as in the          example. However, it’s not required. Realize though, that to          facilitate Lazy Loading, this dataSource is required.        </p>
<p>There are three built-in dataSource types (i.e. type=”[UNPOOLED|POOLED|JNDI]”):        </p>
<p>​          <strong>UNPOOLED</strong>          – This implementation of DataSource simply opens and closes a          connection each time it is requested. While it’s a bit slower, this          is a good choice for simple applications that do not require the          performance of immediately available connections. Different          databases are also different in this performance area, so for some          it may be less important to pool and this configuration will be          ideal. The UNPOOLED DataSource has the following properties to configure:        </p>
<ul>
<li><code>driver</code> – This is the fully qualified Java class of the JDBC            driver (NOT of the DataSource class if your driver includes one).          </li>
<li><code>url</code> – This is the JDBC URL for your database instance.          </li>
<li><code>username</code> – The database username to log in with.          </li>
<li><code>password</code> - The database password to log in with.          </li>
<li><code>defaultTransactionIsolationLevel</code> – The default transaction            isolation level for connections.          </li>
<li><code>defaultNetworkTimeout</code> – The default network timeout  value in milliseconds to wait for the database operation to complete.  See the API documentation of <code>java.sql.Connection#setNetworkTimeout()</code> for details.          </li>
</ul>
<p>​          Optionally, you can pass properties to the database driver as          well. To do          this, prefix the properties with <code>driver.</code>, for example:        </p>
<ul>
<li><code>driver.encoding=UTF8</code></li>
</ul>
<p>​          This will pass the property <code>encoding</code>, with the value <code>UTF8</code>, to          your          database driver via the <code>DriverManager.getConnection(url,          driverProperties)</code> method.        </p>
<p>​          <strong>POOLED</strong>          – This implementation of DataSource pools JDBC Connection objects          to          avoid the initial connection and authentication time required to          create a new Connection instance. This is a popular approach for          concurrent web applications to achieve the fastest response.        </p>
<p>​          In addition to the (UNPOOLED) properties above, there are many          more          properties that can be used to configure the POOLED datasource:        </p>
<ul>
<li><code>poolMaximumActiveConnections</code> – This is the number of active            (i.e. in use) connections that can exist at any given time.            Default: 10          </li>
<li><code>poolMaximumIdleConnections</code> – The number of idle connections            that            can exist at any given time.          </li>
<li><code>poolMaximumCheckoutTime</code> – This is the amount of time that a            Connection can be “checked out” of the pool before it will be            forcefully returned. Default: 20000ms (i.e. 20 seconds)          </li>
<li><code>poolTimeToWait</code> – This is a low level setting that gives the            pool            a chance to print a log status and re-attempt the acquisition            of a            connection in the case that it’s taking unusually long (to            avoid            failing silently forever if the pool is misconfigured).            Default:            20000ms (i.e. 20 seconds)          </li>
<li><code>poolMaximumLocalBadConnectionTolerance</code> – This is a low level setting about            tolerance of bad connections got for any thread. If a thread got a bad connection, it may            still have another chance to re-attempt to get another connection which is valid. But the            retrying times should not more than the sum of <code>poolMaximumIdleConnections</code>            and <code>poolMaximumLocalBadConnectionTolerance</code>.            Default:            3 (Since: 3.4.5)          </li>
<li><code>poolPingQuery</code> – The Ping Query is sent to the database to            validate that a connection is in good working order and is ready            to            accept requests. The default is “NO PING QUERY SET”, which will            cause most database drivers to fail with a decent error message.          </li>
<li><code>poolPingEnabled</code> – This enables or disables the ping query. If            enabled, you must also set the poolPingQuery property with a valid            SQL statement (preferably a very fast one). Default: false.          </li>
<li><code>poolPingConnectionsNotUsedFor</code> – This configures how often the            poolPingQuery will be used. This can be set to match the typical            timeout for a database connection, to avoid unnecessary pings.            Default: 0 (i.e. all connections are pinged every time – but only            if poolPingEnabled is true of course).          </li>
</ul>
<p>​          <strong>JNDI</strong>          – This implementation of DataSource is intended for use with          containers such as EJB or Application Servers that may configure          the          DataSource centrally or externally and place a reference to it          in a          JNDI context. This DataSource configuration only requires two          properties:        </p>
<ul>
<li><code>initial_context</code> – This property is used for the Context lookup            from the InitialContext (i.e.            initialContext.lookup(initial_context)). This property is            optional,            and if omitted, then the data_source property will be            looked up            against the InitialContext directly.          </li>
<li><code>data_source</code> – This is the context path where the reference to            the instance of the DataSource can be found. It will be looked up            against the context returned by the initial_context lookup, or            against the InitialContext directly if no initial_context is            supplied.          </li>
</ul>
<p>Similar to the other DataSource configurations, it’s possible to          send properties directly to the InitialContext by prefixing those          properties with <code>env.</code>, for example:        </p>
<ul>
<li><code>env.encoding=UTF8</code></li>
</ul>
<p>​          This would send the property <code>encoding</code> with the value of <code>UTF8</code>          to the          constructor of the InitialContext upon instantiation.        </p>
<p>​          You can plug any 3rd party DataSource by implementing the interface <code>org.apache.ibatis.datasource.DataSourceFactory</code>:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface DataSourceFactory &#123;</span><br><span class="line">  void setProperties(Properties props);</span><br><span class="line">  DataSource getDataSource();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​          <code>org.apache.ibatis.datasource.unpooled.UnpooledDataSourceFactory</code> can be used as super class          to build new datasource adapters. For example this is the code needed to plug C3P0:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.ibatis.datasource.unpooled.UnpooledDataSourceFactory;</span><br><span class="line">import com.mchange.v2.c3p0.ComboPooledDataSource;</span><br><span class="line"></span><br><span class="line">public class C3P0DataSourceFactory extends UnpooledDataSourceFactory &#123;</span><br><span class="line"></span><br><span class="line">  public C3P0DataSourceFactory() &#123;</span><br><span class="line">    this.dataSource = new ComboPooledDataSource();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To set it up, add a property for each setter method you want MyBatis to call.        Follows below a sample configuration which connects to a PostgreSQL database:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dataSource type=&quot;org.myproject.C3P0DataSourceFactory&quot;&gt;</span><br><span class="line">  &lt;property name=&quot;driver&quot; value=&quot;org.postgresql.Driver&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;url&quot; value=&quot;jdbc:postgresql:mydb&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;username&quot; value=&quot;postgres&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">&lt;/dataSource&gt;</span><br></pre></td></tr></table></figure>

<h3 id="databaseIdProvider"><a href="#databaseIdProvider" class="headerlink" title="databaseIdProvider"></a>databaseIdProvider</h3><p>​          MyBatis is able to execute different statements depending on your database vendor.          The multi-db vendor support is based on the mapped statements <code>databaseId</code> attribute.          MyBatis will load all statements with no <code>databaseId</code> attribute          or with a <code>databaseId</code> that matches the current one. In case the same statement          is found with and without the <code>databaseId</code> the latter will be discarded.          To enable the multi vendor support add a <code>databaseIdProvider</code>          to mybatis-config.xml file as follows:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;databaseIdProvider type=&quot;DB_VENDOR&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>​          The DB_VENDOR implementation databaseIdProvider sets as databaseId the String returned by          <code>DatabaseMetaData#getDatabaseProductName()</code>.          Given that usually that string is too long and that different  versions of the same product may return different values,          you may want to convert it to a shorter one by adding  properties like follows:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;databaseIdProvider type=&quot;DB_VENDOR&quot;&gt;</span><br><span class="line">  &lt;property name=&quot;SQL Server&quot; value=&quot;sqlserver&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;DB2&quot; value=&quot;db2&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;Oracle&quot; value=&quot;oracle&quot; /&gt;</span><br><span class="line">&lt;/databaseIdProvider&gt;</span><br></pre></td></tr></table></figure>

<p>​          When properties are provided, the DB_VENDOR databaseIdProvider will search the property value corresponding to the          first key found in the returned database product name or “null” if there is not a matching property.          In this case, if <code>getDatabaseProductName()</code> returns “Oracle (DataDirect)” the databaseId will be set to “oracle”.        </p>
<p>​          You can build your own DatabaseIdProvider by implementing the interface <code>org.apache.ibatis.mapping.DatabaseIdProvider</code>          and registering it in mybatis-config.xml:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public interface DatabaseIdProvider &#123;</span><br><span class="line">  default void setProperties(Properties p) &#123; // Since 3.5.2, changed to default method</span><br><span class="line">    // NOP</span><br><span class="line">  &#125;</span><br><span class="line">  String getDatabaseId(DataSource dataSource) throws SQLException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="mappers"><a href="#mappers" class="headerlink" title="mappers"></a>mappers</h3><p>​          Now that the behavior of MyBatis is configured with the above          configuration elements, we’re ready to define our mapped SQL          statements. But first, we need to tell MyBatis where to find them.          Java doesn’t really provide any good means of auto-discovery in          this regard, so the best way to do it is to simply tell MyBatis          where to find the mapping files. You can use classpath relative          resource references, fully qualified url references          (including <code>file:///</code> URLs), class names or package names.          For example:        </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Using classpath relative resources --&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper resource=&quot;org/mybatis/builder/AuthorMapper.xml&quot;/&gt;</span><br><span class="line">  &lt;mapper resource=&quot;org/mybatis/builder/BlogMapper.xml&quot;/&gt;</span><br><span class="line">  &lt;mapper resource=&quot;org/mybatis/builder/PostMapper.xml&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br><span class="line">&lt;!-- Using url fully qualified paths --&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper url=&quot;file:///var/mappers/AuthorMapper.xml&quot;/&gt;</span><br><span class="line">  &lt;mapper url=&quot;file:///var/mappers/BlogMapper.xml&quot;/&gt;</span><br><span class="line">  &lt;mapper url=&quot;file:///var/mappers/PostMapper.xml&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br><span class="line">&lt;!-- Using mapper interface classes --&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;mapper class=&quot;org.mybatis.builder.AuthorMapper&quot;/&gt;</span><br><span class="line">  &lt;mapper class=&quot;org.mybatis.builder.BlogMapper&quot;/&gt;</span><br><span class="line">  &lt;mapper class=&quot;org.mybatis.builder.PostMapper&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br><span class="line">&lt;!-- Register all interfaces in a package as mappers --&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">  &lt;package name=&quot;org.mybatis.builder&quot;/&gt;</span><br><span class="line">&lt;/mappers&gt;</span><br></pre></td></tr></table></figure>

<p>​          These statement simply tell MyBatis where to go from here. The          rest of the details are in each of the SQL Mapping files, and that’s          exactly what the next section will discuss.        </p>
<hr>
<p>Copyright ©      2009–2021<a target="_blank" rel="noopener" href="https://www.mybatis.org/">MyBatis.org</a>. .</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">secqin</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://liqin123456.github.io/2022/01/22/%E6%B3%A8%E8%A7%A3%E5%92%8C%E5%8F%8D%E5%B0%84/">https://liqin123456.github.io/2022/01/22/%E6%B3%A8%E8%A7%A3%E5%92%8C%E5%8F%8D%E5%B0%84/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://liqin123456.github.io" target="_blank">secqin</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/javase/">javase</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/liqincoding/img/master/95948932_p0_master1200.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2022/01/29/idea%E5%BF%AB%E6%8D%B7%E9%94%AE/"><img class="prev-cover" src="https://raw.githubusercontent.com/liqincoding/img/master/95948932_p0_master1200.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info"></div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="http://q.qlogo.cn/headimg_dl?dst_uin=515262617&amp;spec=640&amp;img_type=jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">secqin</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">24</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/liqin123456"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">以后不搞杂七杂八的技术,就全程跟狂神</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">1. 注解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E6%B3%A8%E8%A7%A3%E5%85%A5%E9%97%A8"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 注解入门</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%86%85%E7%BD%AE%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 内置注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E5%85%83%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 元注解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.4 自定义注解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6"><span class="toc-number">2.</span> <span class="toc-text">2. 反射机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E9%9D%99%E6%80%81vs%E5%8A%A8%E6%80%81%E8%AF%AD%E8%A8%80"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 静态vs动态语言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Java-Reflection"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 Java Reflection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-started"><span class="toc-number">2.3.</span> <span class="toc-text">Getting started</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Installation"><span class="toc-number">2.3.1.</span> <span class="toc-text">Installation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Building-SqlSessionFactory-from-XML"><span class="toc-number">2.3.2.</span> <span class="toc-text">Building SqlSessionFactory from XML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Building-SqlSessionFactory-without-XML"><span class="toc-number">2.3.3.</span> <span class="toc-text">Building SqlSessionFactory without XML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Acquiring-a-SqlSession-from-SqlSessionFactory"><span class="toc-number">2.3.4.</span> <span class="toc-text">Acquiring a SqlSession from SqlSessionFactory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exploring-Mapped-SQL-Statements"><span class="toc-number">2.3.5.</span> <span class="toc-text">Exploring Mapped SQL Statements</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Scope-and-Lifecycle"><span class="toc-number">2.3.6.</span> <span class="toc-text">Scope and Lifecycle</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SqlSessionFactoryBuilder"><span class="toc-number">2.3.6.1.</span> <span class="toc-text">SqlSessionFactoryBuilder</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SqlSessionFactory"><span class="toc-number">2.3.6.2.</span> <span class="toc-text">SqlSessionFactory</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SqlSession"><span class="toc-number">2.3.6.3.</span> <span class="toc-text">SqlSession</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mapper-Instances"><span class="toc-number">2.3.6.4.</span> <span class="toc-text">Mapper Instances</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mybatis"><span class="toc-number">2.4.</span> <span class="toc-text">mybatis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configuration"><span class="toc-number">2.5.</span> <span class="toc-text">Configuration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#properties"><span class="toc-number">2.5.1.</span> <span class="toc-text">properties</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#settings"><span class="toc-number">2.5.2.</span> <span class="toc-text">settings</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#typeAliases"><span class="toc-number">2.5.3.</span> <span class="toc-text">typeAliases</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#typeHandlers"><span class="toc-number">2.5.4.</span> <span class="toc-text">typeHandlers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Handling-Enums"><span class="toc-number">2.5.5.</span> <span class="toc-text">Handling Enums</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#objectFactory"><span class="toc-number">2.5.6.</span> <span class="toc-text">objectFactory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#plugins"><span class="toc-number">2.5.7.</span> <span class="toc-text">plugins</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#environments"><span class="toc-number">2.5.8.</span> <span class="toc-text">environments</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#databaseIdProvider"><span class="toc-number">2.5.9.</span> <span class="toc-text">databaseIdProvider</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mappers"><span class="toc-number">2.5.10.</span> <span class="toc-text">mappers</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/03/08/18-%E5%B7%A6%E7%A5%9E%E7%9A%84%E7%AE%97%E6%B3%95%E8%AF%BE/" title="18-左神的算法课"><img src="https://raw.githubusercontent.com/liqincoding/img/master/95948932_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="18-左神的算法课"/></a><div class="content"><a class="title" href="/2022/03/08/18-%E5%B7%A6%E7%A5%9E%E7%9A%84%E7%AE%97%E6%B3%95%E8%AF%BE/" title="18-左神的算法课">18-左神的算法课</a><time datetime="2022-03-08T09:33:51.000Z" title="发表于 2022-03-08 17:33:51">2022-03-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/26/17-c3%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="17-c3数据结构"><img src="https://raw.githubusercontent.com/liqincoding/img/master/95948932_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="17-c3数据结构"/></a><div class="content"><a class="title" href="/2022/02/26/17-c3%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="17-c3数据结构">17-c3数据结构</a><time datetime="2022-02-26T03:16:38.000Z" title="发表于 2022-02-26 11:16:38">2022-02-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/22/16-AcWing%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE-c-%E5%9F%BA%E7%A1%80/" title="16-AcWing算法基础课(c++基础)"><img src="https://raw.githubusercontent.com/liqincoding/img/master/95948932_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="16-AcWing算法基础课(c++基础)"/></a><div class="content"><a class="title" href="/2022/02/22/16-AcWing%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80%E8%AF%BE-c-%E5%9F%BA%E7%A1%80/" title="16-AcWing算法基础课(c++基础)">16-AcWing算法基础课(c++基础)</a><time datetime="2022-02-22T14:43:30.000Z" title="发表于 2022-02-22 22:43:30">2022-02-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/09/14-Mybatis/" title="14-Mybatis"><img src="https://raw.githubusercontent.com/liqincoding/img/master/95948932_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="14-Mybatis"/></a><div class="content"><a class="title" href="/2022/02/09/14-Mybatis/" title="14-Mybatis">14-Mybatis</a><time datetime="2022-02-09T08:39:14.000Z" title="发表于 2022-02-09 16:39:14">2022-02-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/09/12-js/" title="12-js"><img src="https://raw.githubusercontent.com/liqincoding/img/master/95948932_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="12-js"/></a><div class="content"><a class="title" href="/2022/02/09/12-js/" title="12-js">12-js</a><time datetime="2022-02-09T03:17:30.000Z" title="发表于 2022-02-09 11:17:30">2022-02-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022  <i id="heartbeat" class="fa fas fa-heartbeat"></i> secqin</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'mAJSCjL3XojYLNydrp6vl3PD-gzGzoHsz',
      appKey: 'HcgstxT8G8WoLYmjfXvVSgTj',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script data-pjax defer src="https://cdn.jsdelivr.net/gh/liqin123456/liqin123456.github.io/js/chocolate.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>